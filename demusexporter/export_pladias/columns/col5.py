from .base import BaseStep
import pandas


class Column5(BaseStep):
    _column_name = "okres"
    _code_map = {
        '101': 'Bratislava I',
        '102': 'Bratislava II',
        '103': 'Bratislava III',
        '104': 'Bratislava IV',
        '105': 'Bratislava V',
        '106': 'Malacky',
        '107': 'Pezinok',
        '108': 'Senec',
        '201': 'Dunajská Streda',
        '202': 'Galanta',
        '203': 'Hlohovec',
        '204': 'Piešťany',
        '205': 'Senica',
        '206': 'Skalica',
        '207': 'Trnava',
        '301': 'Bánovce nad Bebravou',
        '302': 'Ilava',
        '303': 'Myjava',
        '304': 'Nové Mesto nad Váhom',
        '305': 'Partizánske',
        '306': 'Považská Bystrica',
        '307': 'Prievidza',
        '308': 'Púchov',
        '309': 'Trenčín',
        '3100': 'Hlavní město Praha',
        '3201': 'Benešov',
        '3202': 'Beroun',
        '3203': 'Kladno',
        '3204': 'Kolín',
        '3205': 'Kutná Hora',
        '3206': 'Mělník',
        '3207': 'Mladá Boleslav',
        '3208': 'Nymburk',
        '3209': 'Praha-východ',
        '3210': 'Praha-západ',
        '3211': 'Příbram',
        '3212': 'Rakovník',
        '3301': 'České Budějovice',
        '3302': 'Český Krumlov',
        '3303': 'Jindřichův Hradec',
        '3304': 'Pelhřimov',
        '3305': 'Písek',
        '3306': 'Prachatice',
        '3307': 'Strakonice',
        '3308': 'Tábor',
        '3401': 'Domažlice',
        '3402': 'Cheb',
        '3403': 'Karlovy Vary',
        '3404': 'Klatovy',
        '3405': 'Plzeň-město',
        '3406': 'Plzeň-jih',
        '3407': 'Plzeň-sever',
        '3408': 'Rokycany',
        '3409': 'Sokolov',
        '3410': 'Tachov',
        '3501': 'Česká Lípa',
        '3502': 'Děčín',
        '3503': 'Chomutov',
        '3504': 'Jablonec nad Nisou',
        '3505': 'Liberec',
        '3506': 'Litoměřice',
        '3507': 'Louny',
        '3508': 'Most',
        '3509': 'Teplice',
        '3510': 'Ústí nad Labem',
        '3601': 'Havlíčkův Brod',
        '3602': 'Hradec Králové',
        '3603': 'Chrudim',
        '3604': 'Jičín',
        '3605': 'Náchod',
        '3606': 'Pardubice',
        '3607': 'Rychnov nad Kněžnou',
        '3608': 'Semily',
        '3609': 'Svitavy',
        '3610': 'Trutnov',
        '3611': 'Ústí nad Orlicí',
        '3701': 'Blansko',
        '3702': 'Brno-město',
        '3703': 'Brno-venkov',
        '3704': 'Břeclav',
        '3705': 'Zlín',
        '3706': 'Hodonín',
        '3707': 'Jihlava',
        '3708': 'Kroměříž',
        '3709': 'Prostějov',
        '3710': 'Třebíč',
        '3711': 'Uherské Hradiště',
        '3712': 'Vyškov',
        '3713': 'Znojmo',
        '3714': 'Žďár nad Sázavou',
        '3801': 'Bruntál',
        '3802': 'Frýdek-Místek',
        '3803': 'Karviná',
        '3804': 'Nový Jičín',
        '3805': 'Olomouc',
        '3806': 'Opava',
        '3807': 'Ostrava-město',
        '3808': 'Přerov',
        '3809': 'Šumperk',
        '3810': 'Vsetín',
        '3811': 'Jeseník',
        '401': 'Komárno',
        '402': 'Levice',
        '403': 'Nitra',
        '404': 'Nové Zámky',
        '405': 'Šaľa',
        '406': 'Topolčany',
        '407': 'Zlaté Moravce',
        '501': 'Bytča',
        '502': 'Čadca',
        '503': 'Dolný Kubín',
        '504': 'Kysucké Nové Mesto',
        '505': 'Liptovský Mikuláš',
        '506': 'Martin',
        '507': 'Námestovo',
        '508': 'Ružomberok',
        '509': 'Turčianske Teplice',
        '510': 'Tvrdošín',
        '511': 'Žilina',
        '601': 'Banská Bystrica',
        '602': 'Banská Štiavnica',
        '603': 'Brezno',
        '604': 'Detva',
        '605': 'Krupina',
        '606': 'Lučenec',
        '607': 'Poltár',
        '608': 'Revúca',
        '609': 'Rimavská Sobota',
        '610': 'Velký Krtíš',
        '611': 'Zvolen',
        '612': 'Žarnovica',
        '613': 'Žiar nad Hronom',
        '701': 'Bardejov',
        '702': 'Humenné',
        '703': 'Kežmarok',
        '704': 'Levoča',
        '705': 'Medzilaborce',
        '706': 'Poprad',
        '707': 'Prešov',
        '708': 'Sabinov',
        '709': 'Snina',
        '710': 'Stará Lubovňa',
        '711': 'Stropkov',
        '712': 'Svidník',
        '713': 'Vranov nad Toplou',
        '801': 'Gelnica',
        '802': 'Košice I',
        '803': 'Košice II',
        '804': 'Košice III',
        '805': 'Košice IV',
        '806': 'Košice - okolie',
        '807': 'Michalovce',
        '808': 'Rožňava',
        '809': 'Sobrance',
        '810': 'Spišská Nová Ves',
        '811': 'Trebišov'
    }

    def compute(self) -> pandas.DataFrame:
        # připojíme okres k sbírkám podle Lokalita_S
        merged = self._sbirky.merge(
            self._lokality[['ZkrLok_L', 'Okres_L']],
            left_on='Lokalita_S',
            right_on='ZkrLok_L',
            how='left'
        )

        # vyčistíme a převedeme kód na string
        merged['Okres_L'] = merged['Okres_L'].dropna().astype(int).astype(str).reindex(merged.index)

        # přemapujeme kód na jméno okresu
        merged[self._column_name] = merged['Okres_L'].map(self._code_map).fillna(merged['Okres_L'])

        return merged[[self._column_name]]

